<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DIY Help Centre</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  /* Layered design with CSS variables and dark theme override.
     Purpose: clear separation between page, surface, and content layers. */
  :root{
    --page-bg: linear-gradient(180deg, #f6f8fb 0%, #ffffff 100%);
    --canvas: #f1f5f9;            /* behind panels */
    --surface: #ffffff;           /* panels */
    --panel: #ffffff;             /* immediate content surface */
    --muted: #6b7280;
    --text: #0f172a;
    --accent-600: #0b78ff;
    --accent-400: #3ea0ff;
    --glass: rgba(255,255,255,0.6);
    --card-radius: 14px;
    --container-width: 1120px;
    --shadow-1: 0 6px 18px rgba(12,18,31,0.06);
    --shadow-2: 0 10px 30px rgba(12,18,31,0.08);
  }

  [data-theme="dark"]{
    --page-bg: linear-gradient(180deg, #071028 0%, #04101a 100%);
    --canvas: #061322;
    --surface: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    --panel: rgba(255,255,255,0.02);
    --muted: #9aa7b6;
    --text: #e6eef8;
    --accent-600: #3ea0ff;
    --accent-400: #6fc0ff;
    --glass: rgba(255,255,255,0.03);
    --card-radius: 12px;
    --shadow-1: 0 10px 30px rgba(3,8,14,0.6);
    --shadow-2: 0 20px 50px rgba(3,8,14,0.6);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: var(--page-bg);
    color: var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* A center canvas with subtle padding and a soft surface behind content */
  .canvas {
    min-height:100vh;
    padding:48px 20px;
    background: var(--canvas);
    display:flex;
    justify-content:center;
  }

  .container{
    width:100%;
    max-width:var(--container-width);
  }

  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:16px;
    margin-bottom:24px;
  }

  .brand {
    display:flex;
    gap:14px;
    align-items:center;
  }
  .logo {
    width:48px;height:48px;border-radius:10px;
    background: linear-gradient(135deg,var(--accent-600), var(--accent-400));
    box-shadow: 0 6px 20px rgba(14,76,210,0.18);
    display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:18px;
  }
  h1{margin:0;font-size:18px;letter-spacing:-0.02em}
  .subtitle{color:var(--muted);font-size:13px;margin-top:2px}

  .header-actions{display:flex;gap:10px;align-items:center}

  .btn {
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
    border: 1px solid rgba(16,24,40,0.06);
    padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;display:inline-flex;gap:8px;align-items:center;
    box-shadow: var(--shadow-1);
  }
  [data-theme="dark"] .btn {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid rgba(255,255,255,0.04);
    box-shadow: var(--shadow-1);
    color: var(--accent-400)
  }
  .btn.ghost { background:transparent;border:0;box-shadow:none;color:var(--muted);font-weight:600 }

  /* Search area */
  .search-wrap {
    margin-top:12px;
    display:flex;
    gap:18px;
    align-items:center;
    background: var(--surface);
    padding:18px;
    border-radius:16px;
    box-shadow: var(--shadow-2);
    border: 1px solid rgba(0,0,0,0.04);
  }
  .search-left{flex:1;display:flex;gap:12px;align-items:center}
  .search-input{
    flex:1;padding:14px;border-radius:12px;border:1px solid rgba(16,24,40,0.06);font-size:15px;background:transparent;outline:none;
  }
  [data-theme="dark"] .search-input{border:1px solid rgba(255,255,255,0.04)}
  .accent-btn{
    background: linear-gradient(180deg,var(--accent-600), var(--accent-400));
    color:white;padding:12px 16px;border-radius:12px;border:0;font-weight:700;cursor:pointer;box-shadow: 0 10px 30px rgba(3, 146, 255, 0.14);
  }

  /* Layout grid */
  .grid{
    margin-top:20px;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:20px;
    align-items:start;
  }
  @media (max-width:980px){
    .grid{grid-template-columns:1fr}
  }

  /* Article list card */
  .card-layer{
    background: linear-gradient(180deg, var(--panel), rgba(255,255,255,0.02));
    border-radius:var(--card-radius);
    padding:18px;
    box-shadow: var(--shadow-1);
    border: 1px solid rgba(0,0,0,0.04);
  }
  [data-theme="dark"] .card-layer{ border: 1px solid rgba(255,255,255,0.03) }

  [data-theme="dark"] #categoryFilter { color: var(--accent-400) }

  .article-item{
    display:flex;gap:14px;align-items:flex-start;padding:12px;border-radius:10px;
    transition:transform .14s ease, box-shadow .14s ease;
  }
  .article-item:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(2,6,23,0.18) }

  .article-meta{font-size:13px;color:var(--muted);margin-top:6px}
  .pill{background:transparent;border-radius:999px;padding:6px 10px;border:1px solid rgba(0,0,0,0.06);font-size:12px;color:var(--muted)}
  [data-theme="dark"] .pill{border:1px solid rgba(255,255,255,0.04)}

  .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .tag{
    font-size:12px;padding:6px 10px;border-radius:999px;background:rgba(11,120,255,0.08);color:var(--accent-600);font-weight:600;
  }
  [data-theme="dark"] .tag{background:rgba(62,160,255,0.12);color:var(--accent-400)}

  /* Sidebar */
  .sidebar .card{
    padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.94));border:1px solid rgba(0,0,0,0.04);
  }
  [data-theme="dark"] .sidebar .card{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03) }

  .muted{color:var(--muted)}
  a { color: inherit; text-decoration:none; }

  footer{margin-top:28px;color:var(--muted);font-size:13px;text-align:center}
</style>
<script src="/static/custom-alert.js"></script>
</head>
<body>
  <div class="canvas" id="canvas" data-theme="light">
    <div class="container">
      <header>
        <div class="brand">
          <a href="/"><img class="logo" src="/static/android-chrome-192x192.png" alt="Future Notes Logo"></a>
          <div>
            <h1>Future Notes Help Centre</h1>
            <div class="subtitle">Were here for you!</div>
          </div>
        </div>

        <div class="header-actions">
          <button id="themeBtn" class="btn" title="Toggle light / dark">Theme</button>
        </div>
      </header>

      <div class="search-wrap">
        <div class="search-left">
          <input id="q" class="search-input" placeholder="Search guides, e.g. shelf, sanding, router, measurement" />
          <select id="categoryFilter" style="border-radius:10px;padding:10px;border:1px solid rgba(0,0,0,0.06);background:transparent">
            <option value="">All categories</option>
          </select>
        </div>
        <div style="display:flex;gap:12px;align-items:center">
          <button id="searchBtn" class="accent-btn">Search</button>
        </div>
      </div>

      <div class="grid">
        <main>
          <div class="card-layer" id="results">
            <!-- article list -->
          </div>
        </main>

        <aside class="sidebar">
          <div class="card">
            <strong>Welcome to the Help Centre</strong>
            <p class="muted" style="margin-top:8px">Find info guides on the all of Future Notes. Use search or pick a category.</p>
          </div>

          <div class="card" style="margin-top:14px">
            <strong>Popular categories</strong>
            <div id="categories" style="margin-top:10px;display:flex;flex-wrap:wrap;gap:8px"></div>
          </div>
        </aside>
      </div>
    </div>
  </div>

<script>
  // Theme handling (persisted)
  (function () {
    const STORE_KEY = 'hc_theme';
    const META_SELECTOR = 'meta[name="theme-color"]';

    function applyTheme(theme) {
        // Global attribute on <html> so all pages/components respond
        const html = document.documentElement;
        html.setAttribute('data-theme', theme);            // css: html[data-theme="dark"] { ... }
        if (theme === 'dark') html.classList.add('theme-dark'); else html.classList.remove('theme-dark');

        // persist
        localStorage.setItem(STORE_KEY, theme);

        // update mobile bar color (optional)
        let meta = document.querySelector(META_SELECTOR);
        if (!meta) {
        meta = document.createElement('meta');
        meta.name = 'theme-color';
        document.head.appendChild(meta);
        }
        meta.content = (theme === 'dark') ? '#041018' : '#ffffff';

        // optional: swap images that declare data-theme-src-light / data-theme-src-dark
        document.querySelectorAll('[data-theme-src-light], [data-theme-src-dark]').forEach(img => {
        const light = img.getAttribute('data-theme-src-light');
        const dark = img.getAttribute('data-theme-src-dark');
        if (theme === 'dark' && dark) img.src = dark;
        else if (theme === 'light' && light) img.src = light;
        });
    }

    function toggleTheme() {
        const cur = localStorage.getItem(STORE_KEY) ||
                    (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        console.log("Theme toggle button pressed!");
        applyTheme(cur === 'dark' ? 'light' : 'dark');
    }

    // init on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
        const saved = localStorage.getItem(STORE_KEY);
        const defaultTheme = saved || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        applyTheme(defaultTheme);

        // wire up theme toggle button by id
        const btn = document.getElementById('themeBtn');
        if (btn) {
        btn.addEventListener('click', toggleTheme);
        }

    });

    // expose a function if you want to call it manually
    window.hcTheme = { applyTheme, toggleTheme };
    })();

  async function fetchArticles(q='', category='') {
    const params = new URLSearchParams();
    if(q) params.set('q', q);
    if(category) params.set('category', category);
    const res = await fetch('/api/articles?'+params.toString());
    return await res.json();
  }

  function makeArticleNode(a){
    const div = document.createElement('div');
    div.className = 'article-item';
    div.style.borderBottom = '1px solid rgba(0,0,0,0.04)';
    div.innerHTML = `
      <div style="flex:1">
        <a href="/help/article/${a.slug}"><div style="font-weight:700;font-size:16px">${a.title}</div></a>
        <div class="article-meta">${a.category ? a.category + ' • ' : ''}${a.excerpt || ''}</div>
        <div class="tags" style="margin-top:8px"></div>
      </div>
      <div style="min-width:110px;text-align:right">
        <div class="pill">${a.view_count || 0} views</div>
        <div style="margin-top:8px;color:var(--muted);font-size:12px">${new Date(a.updated_at).toLocaleDateString()}</div>
      </div>
    `;
    (a.tags || []).slice(0,4).forEach(t=>{
      const span = document.createElement('span'); span.className='tag'; span.textContent=t; div.querySelector('.tags').appendChild(span);
    });
    return div;
  }

  async function doSearch(){
    const q = document.getElementById('q').value.trim();
    const category = document.getElementById('categoryFilter').value;
    const payload = await fetchArticles(q, category);
    const results = document.getElementById('results');
    results.innerHTML = '';
    if(payload.articles && payload.articles.length){
      payload.articles.forEach(a => results.appendChild(makeArticleNode(a)));
    } else {
      results.innerHTML = '<div style="padding:18px">No results — try different keywords.</div>';
    }
    populateCategories(payload.articles || []);
  }

  function populateCategories(articles){
    const set = new Set();
    articles.forEach(a=> a.category && set.add(a.category));
    const container = document.getElementById('categories');
    container.innerHTML = '';
    Array.from(set).slice(0,8).forEach(c=>{
      const btn = document.createElement('button');
      btn.className='pill';
      btn.style.cursor='pointer';
      btn.textContent=c;
      btn.addEventListener('click', ()=> { document.getElementById('categoryFilter').value = c; doSearch(); });
      container.appendChild(btn);
    });
    // also populate category select if empty (simple)
    const select = document.getElementById('categoryFilter');
    if(select.options.length <= 1){
      Array.from(set).forEach(c=>{
        const o = document.createElement('option'); o.value = c; o.text = c; select.add(o);
      });
    }
  }

  document.getElementById('searchBtn').addEventListener('click', doSearch);
  document.getElementById('q').addEventListener('keydown', (e)=>{ if(e.key==='Enter') doSearch(); });

  // initial
  doSearch();
</script>
</body>
</html>